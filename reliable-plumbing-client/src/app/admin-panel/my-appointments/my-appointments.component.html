<section>
  <div class="">
    <button class="btn btn-primary filters-toggle-btn pointer" type="button" data-toggle="collapse" data-target="#filter-toggle"
      aria-expanded="false" aria-controls="filter-toggle">
      <i class="fa fa-filter" aria-hidden="true"></i>filters
    </button>
    <div class="filters-container collapse" id="filter-toggle">
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <h5>select Range Dates</h5>
            <div>
              <multi-select-datepicker [dates]="filterDates" (datesChanged)="updateDates($event)"></multi-select-datepicker>
            </div>
          </div>
        </div>
        <div class="col-sm-12">
          <button class="btn btn-primary filters-toggle-btn pull-right" (click)="filter()">Filter</button>
        </div>
      </div>
    </div>
    <div>
      <div class="row">
        <section class="appointemts-sec" class="col-sm-12">
          <loader *ngIf="loadingFiltered"></loader>
          <!-- appointments Listing -->
          <ng-container *ngIf="!loadingFiltered">
            <br />
            <h3>Appointemts List:</h3>
            <div class="appointemts-list" *ngFor="let date of datesArrayBetweenFilterDates">
              <h5>{{date | date}}</h5>
              <no-data *ngIf="appointments[date] == null || appointments[date].length == 0" [message]="'no appointemts for this day'"></no-data>
              <div class="row">
                <div class="col-sm-4" *ngFor="let appointment of appointments[date]">
                  <div class="appointemt-card">
                    <h6>
                      <span class="appointemt-status pending" [ngClass]="appointment.status | appointmentStatusColor" placement="top" ngbTooltip="{{appointment.status | appointmentStatusTxt}}"></span>
                      <b>{{appointment.user == null ? appointment.fullName : appointment.user.firstName}}</b>
                    </h6>
                    <div class="appointemt-time">
                      <span>{{appointment.time}}</span>
                    </div>
                    <div class="appointemt-type">
                      <span>{{appointment.type?.name}}</span>
                    </div>
                    <div *ngIf="appointment.checkInDetails != null">
                      <span>last check at: {{appointment.checkInDetails.date | date:'medium'}}</span>
                    </div>
                    <button (click)="openCheckInMap(appointment, checkInMap)" class="btn btn-success">check in</button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </section>
      </div>
    </div>
  </div>
</section>

<ng-template #checkInMap let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h5 class="modal-title">Current Location</h5>
    <button type="button" class="close" aria-label="Close" (click)="c()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="map-container">
      <agm-map [latitude]="mapMarker.lat" [longitude]="mapMarker.lng" [zoom]="15" [disableDefaultUI]="false" [zoomControl]="true">
        <agm-marker [latitude]="mapMarker.lat" [longitude]="mapMarker.lng" [label]="mapMarker.label" [markerDraggable]="mapMarker.draggable"
          (dragEnd)="markerDragEnd(m, $event)">
          <agm-info-window>
            <strong>Your Location</strong>
          </agm-info-window>
        </agm-marker>
      </agm-map>
    </div>

    <button class="btn btn-primary" (click)="checkIn()">Check in</button>
  </div>

</ng-template>
